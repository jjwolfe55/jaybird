WITH game_log AS (
SELECT 
game_id,
h_team_id AS team,
season_id,
game_type,
game_date,
start_time,
"Home" AS location,
ballpark,
precipitation,
sky_condition,
temp,
wind_direction,
wind_speed,
attendance,
game_time AS game_duration,
(CASE WHEN winning_team = h_team_id THEN 'W' 
WHEN winning_team  = '' THEN 'T' ELSE 'L' END) AS  result,
h_team_runs AS runs,
v_team_runs AS runs_against
FROM lines_games
UNION ALL
SELECT 
game_id,
v_team_id AS team,
season_id,
game_type,
game_date,
start_time,
"Away" AS location,
ballpark,
precipitation,
sky_condition,
temp,
wind_direction,
wind_speed,
attendance,
game_time AS game_duration,
(CASE WHEN winning_team = v_team_id THEN 'W' 
WHEN winning_team  = '' THEN 'T' ELSE 'L' END) AS  result,
v_team_runs AS runs,
h_team_runs AS runs_against
FROM lines_games
)
SELECT *, rank() OVER (PARTITION BY team, season_id ORDER BY game_date ASC) AS game_num
FROM game_log
ORDER BY  team ASC, season_id DESC, game_date ASC;
