CREATE VIEW season_total_war AS
WITH batters AS ( 
SELECT player_id, player_name, season_id, age 
FROM standard_batting )
 
, pitchers AS ( 
SELECT player_id, player_name, season_id, age 
FROM standard_pitching ) 

, fielders AS ( 
SELECT player_id, player_name, season_id, age 
FROM standard_fielding ) 

, player_pool AS (
SELECT player_id, player_name, season_id, age 
FROM batters 
UNION  
SELECT player_id, player_name, season_id, age 
FROM pitchers 
UNION  
SELECT player_id, player_name, season_id, age 
FROM fielders ) 

, batting_war AS ( 
SELECT player_id, season_id, SUM(mri_batting_war) AS mri_war 
FROM mri_creating_batting 
GROUP BY player_id, season_id ) 

, c_baserunning_war AS ( 
SELECT player_id, season_id, SUM(mri_c_baserunning_war) AS mri_c_baserunning_war 
FROM mri_creating_baserunning 
GROUP BY player_id, season_id ) 

, pitching_war AS ( 
SELECT player_id, season_id, SUM(mri_pitching_war) AS mri_war 
FROM mri_preventing_pitching 
GROUP BY player_id, season_id ) 

, fielding_war AS ( 
SELECT player_id, season_id, SUM(mri_fielding_war) AS mri_war 
FROM mri_preventing_fielding 
GROUP BY player_id, season_id ) 

, p_baserunning_war AS ( 
SELECT player_id, season_id, SUM(mri_p_baserunning_war) AS mri_p_baserunning_war 
FROM mri_preventing_baserunning 
GROUP BY player_id, season_id )
 
, rpt AS ( 
SELECT a.player_id, 
a.player_name,
 a.season_id,
 a.age,
 b.mri_war AS batting_war,
 c.mri_c_baserunning_war AS c_baserunning_war,
 d.mri_war AS pitching_war,
 e.mri_war AS fielding_war,
 f.mri_p_baserunning_war AS p_baserunning_war,
 IfNULL(b.mri_war,0) +
 IfNULL(c.mri_c_baserunning_war,0) +
 IfNULL(d.mri_war,0) +
 IfNULL(e.mri_war,0) +
 ifnull(f.mri_p_baserunning_war,0) AS total_war 
 FROM player_pool AS a 
 LEFT JOIN batting_war AS b 
 ON a.player_id = b.player_id AND a.season_id = b.season_id 
 LEFT JOIN c_baserunning_war AS c 
 ON a.player_id = c.player_id AND a.season_id = c.season_id 
 LEFT JOIN pitching_war AS d 
 ON a.player_id = d.player_id AND a.season_id = d.season_id 
 LEFT JOIN fielding_war AS e 
 ON a.player_id = e.player_id AND a.season_id = e.season_id 
 LEFT JOIN p_baserunning_war AS f 
 ON a.player_id = f.player_id AND a.season_id = f.season_id) 
 
  SELECT * 
  FROM rpt 
  ORDER BY total_war DESC;

CREATE VIEW season_total_war_x_team AS
WITH batters AS ( 
SELECT player_id, player_name, team_id, season_id, age 
FROM standard_batting )
 
, pitchers AS ( 
SELECT player_id, player_name, team_id, season_id, age 
FROM standard_pitching ) 

, fielders AS ( 
SELECT player_id, player_name, team_id, season_id, age 
FROM standard_fielding ) 

, player_pool AS (
SELECT player_id, player_name, team_id, season_id, age 
FROM batters 
UNION  
SELECT player_id, player_name, team_id, season_id, age 
FROM pitchers 
UNION  
SELECT player_id, player_name, team_id, season_id, age 
FROM fielders ) 

, batting_war AS ( 
SELECT player_id, team_id, season_id, SUM(mri_batting_war) AS mri_war 
FROM mri_creating_batting 
GROUP BY player_id, team_id, season_id ) 

, c_baserunning_war AS ( 
SELECT player_id, team_id, season_id, SUM(mri_c_baserunning_war) AS mri_c_baserunning_war 
FROM mri_creating_baserunning 
GROUP BY player_id, team_id, season_id ) 

, pitching_war AS ( 
SELECT player_id, team_id, season_id, SUM(mri_pitching_war) AS mri_war 
FROM mri_preventing_pitching 
GROUP BY player_id, team_id, season_id ) 

, fielding_war AS ( 
SELECT player_id, team_id, season_id, SUM(mri_fielding_war) AS mri_war 
FROM mri_preventing_fielding 
GROUP BY player_id, team_id, season_id ) 

, p_baserunning_war AS ( 
SELECT player_id, team_id, season_id, SUM(mri_p_baserunning_war) AS mri_p_baserunning_war 
FROM mri_preventing_baserunning 
GROUP BY player_id, team_id, season_id )
 
, rpt AS ( 
SELECT a.player_id, 
 a.player_name,
 a.team_id,
 a.season_id,
 a.age,
 b.mri_war AS batting_war,
 c.mri_c_baserunning_war AS c_baserunning_war,
 d.mri_war AS pitching_war,
 e.mri_war AS fielding_war,
 f.mri_p_baserunning_war AS p_baserunning_war,
 IfNULL(b.mri_war,0) +
 IfNULL(c.mri_c_baserunning_war,0) +
 IfNULL(d.mri_war,0) +
 IfNULL(e.mri_war,0) +
 ifnull(f.mri_p_baserunning_war,0) AS total_war 
 FROM player_pool AS a 
 LEFT JOIN batting_war AS b 
 ON a.player_id = b.player_id AND a.team_id = b.team_id AND a.season_id = b.season_id 
 LEFT JOIN c_baserunning_war AS c 
 ON a.player_id = c.player_id AND a.team_id = c.team_id AND a.season_id = c.season_id 
 LEFT JOIN pitching_war AS d 
 ON a.player_id = d.player_id AND a.team_id = d.team_id AND a.season_id = d.season_id 
 LEFT JOIN fielding_war AS e 
 ON a.player_id = e.player_id AND a.team_id = e.team_id AND a.season_id = e.season_id 
 LEFT JOIN p_baserunning_war AS f 
 ON a.player_id = f.player_id AND a.team_id = f.team_id AND a.season_id = f.season_id) 
 
  SELECT * 
  FROM rpt 
  ORDER BY total_war DESC;

CREATE VIEW career_total_war AS
WITH batters AS ( 
SELECT player_id, player_name  
FROM standard_batting )
 
, pitchers AS ( 
SELECT player_id, player_name 
FROM standard_pitching ) 

, fielders AS ( 
SELECT player_id, player_name 
FROM standard_fielding ) 

, player_pool AS (
SELECT player_id, player_name
FROM batters 
UNION  
SELECT player_id, player_name
FROM pitchers 
UNION  
SELECT player_id, player_name
FROM fielders ) 

, batting_war AS ( 
SELECT player_id, SUM(mri_batting_war) AS mri_war 
FROM mri_creating_batting 
GROUP BY player_id) 

, c_baserunning_war AS ( 
SELECT player_id, SUM(mri_c_baserunning_war) AS mri_c_baserunning_war 
FROM mri_creating_baserunning 
GROUP BY player_id) 

, pitching_war AS ( 
SELECT player_id, SUM(mri_pitching_war) AS mri_war 
FROM mri_preventing_pitching 
GROUP BY player_id) 

, fielding_war AS ( 
SELECT player_id, SUM(mri_fielding_war) AS mri_war 
FROM mri_preventing_fielding 
GROUP BY player_id) 

, p_baserunning_war AS ( 
SELECT player_id, SUM(mri_p_baserunning_war) AS mri_p_baserunning_war 
FROM mri_preventing_baserunning 
GROUP BY player_id)
 
, rpt AS ( 
SELECT a.player_id, 
 a.player_name,
 b.mri_war AS batting_war,
 c.mri_c_baserunning_war AS c_baserunning_war,
 d.mri_war AS pitching_war,
 e.mri_war AS fielding_war,
 f.mri_p_baserunning_war AS p_baserunning_war,
 IfNULL(b.mri_war,0) +
 IfNULL(c.mri_c_baserunning_war,0) +
 IfNULL(d.mri_war,0) +
 IfNULL(e.mri_war,0) +
 ifnull(f.mri_p_baserunning_war,0) AS total_war 
 FROM player_pool AS a 
 LEFT JOIN batting_war AS b 
 ON a.player_id = b.player_id  
 LEFT JOIN c_baserunning_war AS c 
 ON a.player_id = c.player_id 
 LEFT JOIN pitching_war AS d 
 ON a.player_id = d.player_id
 LEFT JOIN fielding_war AS e 
 ON a.player_id = e.player_id 
 LEFT JOIN p_baserunning_war AS f 
 ON a.player_id = f.player_id)
 
  SELECT * 
  FROM rpt 
  ORDER BY total_war DESC;

CREATE VIEW career_total_war_x_team AS
WITH batters AS ( 
SELECT player_id, player_name, team_id
FROM standard_batting )
 
, pitchers AS ( 
SELECT player_id, player_name, team_id
FROM standard_pitching ) 

, fielders AS ( 
SELECT player_id, player_name, team_id
FROM standard_fielding ) 

, player_pool AS (
SELECT player_id, player_name, team_id
FROM batters 
UNION  
SELECT player_id, player_name, team_id
FROM pitchers 
UNION  
SELECT player_id, player_name, team_id
FROM fielders ) 

, batting_war AS ( 
SELECT player_id, team_id, SUM(mri_batting_war) AS mri_war 
FROM mri_creating_batting 
GROUP BY player_id, team_id) 

, c_baserunning_war AS ( 
SELECT player_id, team_id, SUM(mri_c_baserunning_war) AS mri_c_baserunning_war 
FROM mri_creating_baserunning 
GROUP BY player_id, team_id) 

, pitching_war AS ( 
SELECT player_id, team_id, SUM(mri_pitching_war) AS mri_war 
FROM mri_preventing_pitching 
GROUP BY player_id, team_id) 

, fielding_war AS ( 
SELECT player_id, team_id, SUM(mri_fielding_war) AS mri_war 
FROM mri_preventing_fielding 
GROUP BY player_id, team_id) 

, p_baserunning_war AS ( 
SELECT player_id, team_id, SUM(mri_p_baserunning_war) AS mri_p_baserunning_war 
FROM mri_preventing_baserunning 
GROUP BY player_id, team_id)
 
, rpt AS ( 
SELECT a.player_id, 
 a.player_name,
 a.team_id,
 b.mri_war AS batting_war,
 c.mri_c_baserunning_war AS c_baserunning_war,
 d.mri_war AS pitching_war,
 e.mri_war AS fielding_war,
 f.mri_p_baserunning_war AS p_baserunning_war,
 IfNULL(b.mri_war,0) +
 IfNULL(c.mri_c_baserunning_war,0) +
 IfNULL(d.mri_war,0) +
 IfNULL(e.mri_war,0) +
 ifnull(f.mri_p_baserunning_war,0) AS total_war 
 FROM player_pool AS a 
 LEFT JOIN batting_war AS b 
 ON a.player_id = b.player_id AND a.team_id = b.team_id
 LEFT JOIN c_baserunning_war AS c 
 ON a.player_id = c.player_id AND a.team_id = c.team_id 
 LEFT JOIN pitching_war AS d 
 ON a.player_id = d.player_id AND a.team_id = d.team_id 
 LEFT JOIN fielding_war AS e 
 ON a.player_id = e.player_id AND a.team_id = e.team_id 
 LEFT JOIN p_baserunning_war AS f 
 ON a.player_id = f.player_id AND a.team_id = f.team_id) 
 
  SELECT * 
  FROM rpt 
  ORDER BY total_war DESC;

CREATE VIEW season_team_total_war AS
WITH batters AS ( 
SELECT team_id, season_id
FROM standard_batting )
 
, pitchers AS ( 
SELECT team_id, season_id
FROM standard_pitching ) 

, fielders AS ( 
SELECT team_id, season_id
FROM standard_fielding ) 

, player_pool AS (
SELECT team_id, season_id
FROM batters 
UNION  
SELECT team_id, season_id
FROM pitchers 
UNION  
SELECT team_id, season_id 
FROM fielders ) 

, batting_war AS ( 
SELECT team_id, season_id, SUM(mri_batting_war) AS mri_war 
FROM mri_creating_batting 
GROUP BY team_id, season_id ) 

, c_baserunning_war AS ( 
SELECT team_id, season_id, SUM(mri_c_baserunning_war) AS mri_c_baserunning_war 
FROM mri_creating_baserunning 
GROUP BY team_id, season_id ) 

, pitching_war AS ( 
SELECT team_id, season_id, SUM(mri_pitching_war) AS mri_war 
FROM mri_preventing_pitching 
GROUP BY team_id, season_id ) 

, fielding_war AS ( 
SELECT team_id, season_id, SUM(mri_fielding_war) AS mri_war 
FROM mri_preventing_fielding 
GROUP BY team_id, season_id ) 

, p_baserunning_war AS ( 
SELECT team_id, season_id, SUM(mri_p_baserunning_war) AS mri_p_baserunning_war 
FROM mri_preventing_baserunning 
GROUP BY team_id, season_id )
 
, rpt AS ( 
SELECT 
 g.franchise_id,
 a.team_id,
 g.nickname,
 g.league_id,
 g.division_id,
 a.season_id,
 b.mri_war AS batting_war,
 c.mri_c_baserunning_war AS c_baserunning_war,
 d.mri_war AS pitching_war,
 e.mri_war AS fielding_war,
 f.mri_p_baserunning_war AS p_baserunning_war,
 IfNULL(b.mri_war,0) +
 IfNULL(c.mri_c_baserunning_war,0) +
 IfNULL(d.mri_war,0) +
 IfNULL(e.mri_war,0) +
 ifnull(f.mri_p_baserunning_war,0) AS total_war 
 FROM player_pool AS a 
 LEFT JOIN batting_war AS b 
 ON a.team_id = b.team_id AND a.season_id = b.season_id 
 LEFT JOIN c_baserunning_war AS c 
 ON a.team_id = c.team_id AND a.season_id = c.season_id 
 LEFT JOIN pitching_war AS d 
 ON a.team_id = d.team_id AND a.season_id = d.season_id 
 LEFT JOIN fielding_war AS e 
 ON a.team_id = e.team_id AND a.season_id = e.season_id 
 LEFT JOIN p_baserunning_war AS f 
 ON a.team_id = f.team_id AND a.season_id = f.season_id
 LEFT JOIN lookup_team_history AS g
 ON a.team_id = g.team_id AND 
 a.season_id BETWEEN g.first_season AND g.last_season)
 
  SELECT * 
  FROM rpt 
  ORDER BY total_war DESC;

CREATE VIEW season_team_total_war_rank AS
WITH team_rank AS (
SELECT a.*,
rank() OVER (partition BY a.season_id ORDER BY a.batting_war DESC) AS batting_rank,
rank() OVER (partition BY a.season_id ORDER BY a.c_baserunning_war DESC) AS c_baserunning_rank,
rank() OVER (partition BY a.season_id ORDER BY a.pitching_war DESC) AS pitching_rank,
rank() OVER (partition BY a.season_id ORDER BY a.fielding_war DESC) AS fielding_rank,
rank() OVER (partition BY a.season_id ORDER BY a.p_baserunning_war DESC) AS p_baserunning_rank,
rank() OVER (partition BY a.season_id ORDER BY a.total_war DESC) AS total_rank,
(CASE WHEN b.winning_team = a.team_id THEN 'WS' ELSE '' END) AS Champion
FROM season_team_total_war AS a
LEFT JOIN standard_world_series AS b
ON a.season_id = b.season_id
ORDER BY season_id DESC,total_war DESC)
SELECT *
FROM team_rank;
