CREATE TABLE fangraphs_lines_games_intake_v1 (
f_game_date VARCHAR(12),
f_team_id CHAR(3),
f_player_count SMALLINT,
f_tbf SMALLINT,
f_era DECIMAL(4,2),
f_h SMALLINT,
f_d SMALLINT,
f_t SMALLINT,
f_r SMALLINT,
f_er SMALLINT,
f_hr SMALLINT,
f_bb SMALLINT,
f_ibb SMALLINT,
f_hbp SMALLINT,
f_so SMALLINT,
f_avg DECIMAL(4,3),
f_obp DECIMAL(4,3),
f_slg DECIMAL(4,3),
f_w_oba DECIMAL(4,3),
PRIMARY KEY (f_game_date,f_team_id,f_tbf,f_r)
);

LOAD DATA LOCAL INFILE "C:/ProgramData/MySQL/MySQL Server 8.0/Uploads/Jaybird/Lines/Fangraphs/fangraphs_lines_games_intake_v1_20260131_UAT.csv"
INTO TABLE fangraphs_lines_games_intake_v1
FIELDS TERMINATED BY ','
LINES TERMINATED BY '\n' 
IGNORE 1 ROWS;

CREATE TABLE fangraphs_lines_games_processed_v1 (
j_game_id VARCHAR(30),
f_game_date VARCHAR(12),
f_team_id CHAR(3),
f_r SMALLINT,
f_so SMALLINT,
f_hr SMALLINT,
f_h SMALLINT,
f_d SMALLINT,
f_t SMALLINT,
f_bb SMALLINT,
PRIMARY KEY (j_game_id)
);

INSERT INTO fangraphs_lines_games_processed_v1 (
j_game_id,
f_game_date,
f_team_id, 
f_tbf,
f_r, 
f_so,
f_hr, 
f_h, 
f_d,
f_t,
f_bb
)
SELECT
CONCAT(f_game_date,f_tbf,f_r,f_so,f_hr,f_h,f_d,f_t,f_bb),
f_game_date,
f_team_id, 
f_tbf,
f_r, 
f_so,
f_hr, 
f_h, 
f_d,
f_t,
f_bb
FROM fangraphs_lines_games_intake_v1;

CREATE TABLE fangraphs_lines_games_intake_v2 (
f_game_date VARCHAR(12),
f_team_id CHAR(3),
f_player_count SMALLINT,
f_pa SMALLINT,
f_ab SMALLINT,
f_h SMALLINT,
f_s SMALLINT,
f_d SMALLINT,
f_t SMALLINT,
f_hr SMALLINT,
f_r SMALLINT,
f_rbi SMALLINT,
f_bb SMALLINT,
f_ibb SMALLINT,
f_so SMALLINT,
f_hbp SMALLINT,
f_sf SMALLINT,
f_sh SMALLINT,
f_gdp SMALLINT,
f_sb SMALLINT,
f_cs SMALLINT,
f_avg DECIMAL(4,3),
PRIMARY KEY (f_game_date,f_team_id,f_pa,f_r)
);

LOAD DATA LOCAL INFILE "C:/ProgramData/MySQL/MySQL Server 8.0/Uploads/Jaybird/Lines/Fangraphs/fangraphs_lines_games_intake_v2_20260131_UAT.csv"
INTO TABLE fangraphs_lines_games_intake_v2
FIELDS TERMINATED BY ','
LINES TERMINATED BY '\n' 
IGNORE 1 ROWS;

CREATE TABLE fangraphs_lines_games_processed_v2 (
j_game_id VARCHAR(30),
f_game_date VARCHAR(12),
f_team_id CHAR(3),
f_pa SMALLINT,
f_r SMALLINT,
f_so SMALLINT,
f_hr SMALLINT,
f_h SMALLINT,
f_d SMALLINT,
f_t SMALLINT,
f_bb SMALLINT,
PRIMARY KEY (j_game_id)
);

INSERT INTO fangraphs_lines_games_processed_v2 (
j_game_id,
f_game_date,
f_team_id, 
f_pa,
f_r, 
f_so,
f_hr, 
f_h, 
f_d,
f_t,
f_bb
)
SELECT
CONCAT(f_game_date,f_pa,f_r,f_so,f_hr,f_h,f_d,f_t,f_bb),
f_game_date,
f_team_id, 
f_pa,
f_r, 
f_so,
f_hr, 
f_h, 
f_d,
f_t,
f_bb
FROM fangraphs_lines_games_intake_v2;

CREATE TABLE fangraphs_lines_games_intake_v3 (
f_game_date VARCHAR(12),
f_team_id CHAR(3),
f_player_count SMALLINT,
f_pa SMALLINT,
f_ab SMALLINT,
f_h SMALLINT,
f_s SMALLINT,
f_d SMALLINT,
f_t SMALLINT,
f_hr SMALLINT,
f_r SMALLINT,
f_rbi SMALLINT,
f_bb SMALLINT,
f_ibb SMALLINT,
f_so SMALLINT,
f_hbp SMALLINT,
f_sf SMALLINT,
f_sh SMALLINT,
f_gdp SMALLINT,
f_sb SMALLINT,
f_cs SMALLINT,
f_avg DECIMAL(4,3),
PRIMARY KEY (f_game_date,f_team_id,f_pa,f_r)
);

LOAD DATA LOCAL INFILE "C:/ProgramData/MySQL/MySQL Server 8.0/Uploads/Jaybird/Lines/Fangraphs/fangraphs_lines_games_intake_v3_20260131_UAT.csv"
INTO TABLE fangraphs_lines_games_intake_v3
FIELDS TERMINATED BY ','
LINES TERMINATED BY '\n' 
IGNORE 1 ROWS;


CREATE TABLE fangraphs_lines_games_processed_v3 (
j_game_id VARCHAR(30),
f_game_date VARCHAR(12),
f_team_id CHAR(3),
f_pa SMALLINT,
f_r SMALLINT,
f_so SMALLINT,
f_hr SMALLINT,
f_h SMALLINT,
f_d SMALLINT,
f_t SMALLINT,
f_bb SMALLINT,
f_home CHAR(1),
PRIMARY KEY (j_game_id)
);


INSERT INTO fangraphs_lines_games_processed_v3 (
j_game_id,
f_game_date,
f_team_id, 
f_pa,
f_r, 
f_so,
f_hr, 
f_h, 
f_d,
f_t,
f_bb,
f_home
)
SELECT
CONCAT(f_game_date,f_pa,f_r,f_so,f_hr,f_h,f_d,f_t,f_bb),
f_game_date,
f_team_id, 
f_pa,
f_r, 
f_so,
f_hr, 
f_h, 
f_d,
f_t,
f_bb,
"Y"
FROM fangraphs_lines_games_intake_v3;

SELECT a.f_team_id AS primary_team, b.f_team_id AS opponent, a.f_game_date AS game_date, a.f_r AS runs_scored, CASE WHEN c.f_home = 'Y' THEN 'Home' ELSE 'Away' END AS home
FROM fangraphs_lines_games_processed_v2 AS a
INNER JOIN fangraphs_lines_games_processed_v1 AS b
ON a.j_game_id = b.j_game_id
LEFT JOIN fangraphs_lines_games_processed_v3 AS c
ON a.j_game_id = c.j_game_id 
AND c.j_game_id = b.j_game_id
