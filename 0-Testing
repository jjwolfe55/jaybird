CREATE TABLE fangraphs_lines_games_intake_pitching_home_day (
f_game_date VARCHAR(12),
f_team_id CHAR(3),
f_player_count SMALLINT,
f_tbf SMALLINT,
f_era DECIMAL(4,2),
f_h SMALLINT,
f_d SMALLINT,
f_t SMALLINT,
f_r SMALLINT,
f_er SMALLINT,
f_hr SMALLINT,
f_bb SMALLINT,
f_ibb SMALLINT,
f_hbp SMALLINT,
f_so SMALLINT,
f_avg DECIMAL(4,3),
f_obp DECIMAL(4,3),
f_slg DECIMAL(4,3),
f_w_oba DECIMAL(4,3),
PRIMARY KEY (f_game_date,f_team_id,f_tbf,f_r)
);

CREATE TABLE fangraphs_lines_games_intake_pitching_home_night (
f_game_date VARCHAR(12),
f_team_id CHAR(3),
f_player_count SMALLINT,
f_tbf SMALLINT,
f_era DECIMAL(4,2),
f_h SMALLINT,
f_d SMALLINT,
f_t SMALLINT,
f_r SMALLINT,
f_er SMALLINT,
f_hr SMALLINT,
f_bb SMALLINT,
f_ibb SMALLINT,
f_hbp SMALLINT,
f_so SMALLINT,
f_avg DECIMAL(4,3),
f_obp DECIMAL(4,3),
f_slg DECIMAL(4,3),
f_w_oba DECIMAL(4,3),
PRIMARY KEY (f_game_date,f_team_id,f_tbf,f_r)
);

CREATE TABLE fangraphs_lines_games_intake_pitching_away_day (
f_game_date VARCHAR(12),
f_team_id CHAR(3),
f_player_count SMALLINT,
f_tbf SMALLINT,
f_era DECIMAL(4,2),
f_h SMALLINT,
f_d SMALLINT,
f_t SMALLINT,
f_r SMALLINT,
f_er SMALLINT,
f_hr SMALLINT,
f_bb SMALLINT,
f_ibb SMALLINT,
f_hbp SMALLINT,
f_so SMALLINT,
f_avg DECIMAL(4,3),
f_obp DECIMAL(4,3),
f_slg DECIMAL(4,3),
f_w_oba DECIMAL(4,3),
PRIMARY KEY (f_game_date,f_team_id,f_tbf,f_r)
);

CREATE TABLE fangraphs_lines_games_intake_pitching_away_night (
f_game_date VARCHAR(12),
f_team_id CHAR(3),
f_player_count SMALLINT,
f_tbf SMALLINT,
f_era DECIMAL(4,2),
f_h SMALLINT,
f_d SMALLINT,
f_t SMALLINT,
f_r SMALLINT,
f_er SMALLINT,
f_hr SMALLINT,
f_bb SMALLINT,
f_ibb SMALLINT,
f_hbp SMALLINT,
f_so SMALLINT,
f_avg DECIMAL(4,3),
f_obp DECIMAL(4,3),
f_slg DECIMAL(4,3),
f_w_oba DECIMAL(4,3),
PRIMARY KEY (f_game_date,f_team_id,f_tbf,f_r)
);

CREATE TABLE fangraphs_lines_games_intake_batting_home_day (
f_game_date VARCHAR(12),
f_team_id CHAR(3),
f_player_count SMALLINT,
f_pa SMALLINT,
f_ab SMALLINT,
f_h SMALLINT,
f_s SMALLINT,
f_d SMALLINT,
f_t SMALLINT,
f_hr SMALLINT,
f_r SMALLINT,
f_rbi SMALLINT,
f_bb SMALLINT,
f_ibb SMALLINT,
f_so SMALLINT,
f_hbp SMALLINT,
f_sf SMALLINT,
f_sh SMALLINT,
f_gdp SMALLINT,
f_sb SMALLINT,
f_cs SMALLINT,
f_avg DECIMAL(4,3),
PRIMARY KEY (f_game_date,f_team_id,f_pa,f_r)
);

CREATE TABLE fangraphs_lines_games_intake_batting_home_night (
f_game_date VARCHAR(12),
f_team_id CHAR(3),
f_player_count SMALLINT,
f_pa SMALLINT,
f_ab SMALLINT,
f_h SMALLINT,
f_s SMALLINT,
f_d SMALLINT,
f_t SMALLINT,
f_hr SMALLINT,
f_r SMALLINT,
f_rbi SMALLINT,
f_bb SMALLINT,
f_ibb SMALLINT,
f_so SMALLINT,
f_hbp SMALLINT,
f_sf SMALLINT,
f_sh SMALLINT,
f_gdp SMALLINT,
f_sb SMALLINT,
f_cs SMALLINT,
f_avg DECIMAL(4,3),
PRIMARY KEY (f_game_date,f_team_id,f_pa,f_r)
);

CREATE TABLE fangraphs_lines_games_intake_batting_away_day (
f_game_date VARCHAR(12),
f_team_id CHAR(3),
f_player_count SMALLINT,
f_pa SMALLINT,
f_ab SMALLINT,
f_h SMALLINT,
f_s SMALLINT,
f_d SMALLINT,
f_t SMALLINT,
f_hr SMALLINT,
f_r SMALLINT,
f_rbi SMALLINT,
f_bb SMALLINT,
f_ibb SMALLINT,
f_so SMALLINT,
f_hbp SMALLINT,
f_sf SMALLINT,
f_sh SMALLINT,
f_gdp SMALLINT,
f_sb SMALLINT,
f_cs SMALLINT,
f_avg DECIMAL(4,3),
PRIMARY KEY (f_game_date,f_team_id,f_pa,f_r)
);

CREATE TABLE fangraphs_lines_games_intake_batting_away_night (
f_game_date VARCHAR(12),
f_team_id CHAR(3),
f_player_count SMALLINT,
f_pa SMALLINT,
f_ab SMALLINT,
f_h SMALLINT,
f_s SMALLINT,
f_d SMALLINT,
f_t SMALLINT,
f_hr SMALLINT,
f_r SMALLINT,
f_rbi SMALLINT,
f_bb SMALLINT,
f_ibb SMALLINT,
f_so SMALLINT,
f_hbp SMALLINT,
f_sf SMALLINT,
f_sh SMALLINT,
f_gdp SMALLINT,
f_sb SMALLINT,
f_cs SMALLINT,
f_avg DECIMAL(4,3),
PRIMARY KEY (f_game_date,f_team_id,f_pa,f_r)
);

DELETE FROM fangraphs_lines_games_intake_batting_away_day;
DELETE FROM fangraphs_lines_games_intake_batting_home_day;
DELETE FROM fangraphs_lines_games_intake_batting_away_night;
DELETE FROM fangraphs_lines_games_intake_batting_home_night;
DELETE FROM fangraphs_lines_games_intake_pitching_away_day;
DELETE FROM fangraphs_lines_games_intake_pitching_home_day;
DELETE FROM fangraphs_lines_games_intake_pitching_away_night;
DELETE FROM fangraphs_lines_games_intake_pitching_home_night;

LOAD DATA LOCAL INFILE "C:/ProgramData/MySQL/MySQL Server 8.0/Uploads/Jaybird/Lines/Fangraphs/Splits Leaderboard Data Home Day_Batting.csv"
INTO TABLE fangraphs_lines_games_intake_batting_home_day
FIELDS TERMINATED BY ','
LINES TERMINATED BY '\n' 
IGNORE 1 ROWS;

LOAD DATA LOCAL INFILE "C:/ProgramData/MySQL/MySQL Server 8.0/Uploads/Jaybird/Lines/Fangraphs/Splits Leaderboard Data Away Day_Batting.csv"
INTO TABLE fangraphs_lines_games_intake_batting_away_day
FIELDS TERMINATED BY ','
LINES TERMINATED BY '\n' 
IGNORE 1 ROWS;

LOAD DATA LOCAL INFILE "C:/ProgramData/MySQL/MySQL Server 8.0/Uploads/Jaybird/Lines/Fangraphs/Splits Leaderboard Data Home Day_Pitching.csv"
INTO TABLE fangraphs_lines_games_intake_pitching_home_day
FIELDS TERMINATED BY ','
LINES TERMINATED BY '\n' 
IGNORE 1 ROWS;

LOAD DATA LOCAL INFILE "C:/ProgramData/MySQL/MySQL Server 8.0/Uploads/Jaybird/Lines/Fangraphs/Splits Leaderboard Data Away Day_Pitching.csv"
INTO TABLE fangraphs_lines_games_intake_pitching_away_day
FIELDS TERMINATED BY ','
LINES TERMINATED BY '\n' 
IGNORE 1 ROWS;

LOAD DATA LOCAL INFILE "C:/ProgramData/MySQL/MySQL Server 8.0/Uploads/Jaybird/Lines/Fangraphs/Splits Leaderboard Data Home Night_Batting.csv"
INTO TABLE fangraphs_lines_games_intake_batting_home_night
FIELDS TERMINATED BY ','
LINES TERMINATED BY '\n' 
IGNORE 1 ROWS;

LOAD DATA LOCAL INFILE "C:/ProgramData/MySQL/MySQL Server 8.0/Uploads/Jaybird/Lines/Fangraphs/Splits Leaderboard Data Away Night_Batting.csv"
INTO TABLE fangraphs_lines_games_intake_batting_away_night
FIELDS TERMINATED BY ','
LINES TERMINATED BY '\n' 
IGNORE 1 ROWS;

LOAD DATA LOCAL INFILE "C:/ProgramData/MySQL/MySQL Server 8.0/Uploads/Jaybird/Lines/Fangraphs/Splits Leaderboard Data Home Night_Pitching.csv"
INTO TABLE fangraphs_lines_games_intake_pitching_home_night
FIELDS TERMINATED BY ','
LINES TERMINATED BY '\n' 
IGNORE 1 ROWS;

LOAD DATA LOCAL INFILE "C:/ProgramData/MySQL/MySQL Server 8.0/Uploads/Jaybird/Lines/Fangraphs/Splits Leaderboard Data Away Night_Pitching.csv"
INTO TABLE fangraphs_lines_games_intake_pitching_away_night
FIELDS TERMINATED BY ','
LINES TERMINATED BY '\n' 
IGNORE 1 ROWS;

CREATE TABLE fangraphs_lines_games_processed (
game_id VARCHAR(30),
h_team_id CHAR(3),
v_team_id CHAR(3),
game_date VARCHAR(12),
day_time CHAR(8),
game_type VARCHAR(15),
h_team_bf SMALLINT,
h_team_runs SMALLINT,
v_team_runs SMALLINT,
winning_team CHAR(3),
losing_team CHAR(3),
season_id SMALLINT,
PRIMARY KEY (game_id)
);

INSERT INTO fangraphs_lines_games_processed (
game_id,
h_team_id,
v_team_id,
game_date,
day_time,
game_type,
h_team_bf,
h_team_runs,
v_team_runs,
winning_team,
losing_team,
season_id
)
WITH home_day_team_runs AS (
SELECT 'day' AS day_time,a.f_game_date AS game_date,a.f_team_id AS h_team_id, b.f_team_id AS v_team_id, a.f_r AS h_team_runs, CONCAT(a.f_game_date,a.f_team_id,b.f_team_id,"day",1) AS game_id
FROM fangraphs_lines_games_intake_batting_home_day AS a
INNER JOIN fangraphs_lines_games_intake_pitching_away_day AS b
ON a.f_game_date = b.f_game_date 
AND a.f_r = b.f_r
AND a.f_h = b.f_h 
AND a.f_d = b.f_d
AND a.f_t = b.f_t
AND a.f_hr = b.f_hr
AND a.f_bb = b.f_bb
AND a.f_ibb = b.f_ibb
AND a.f_hbp = b.f_hbp
AND a.f_so = b.f_so
AND a.f_pa = b.f_tbf
ORDER BY a.f_game_date ASC
)
, away_day_team_runs AS (
SELECT 'day' AS day_time, a.f_game_date AS game_date,a.f_team_id AS v_team_id, b.f_team_id AS h_team_id,b.f_tbf AS h_team_bf, a.f_r AS v_team_runs, CONCAT(a.f_game_date,b.f_team_id,a.f_team_id,"day",1) AS game_id
FROM fangraphs_lines_games_intake_batting_away_day AS a
INNER JOIN fangraphs_lines_games_intake_pitching_home_day AS b
ON a.f_game_date = b.f_game_date 
AND a.f_r = b.f_r
AND a.f_h = b.f_h 
AND a.f_d = b.f_d
AND a.f_t = b.f_t
AND a.f_hr = b.f_hr
AND a.f_bb = b.f_bb
AND a.f_ibb = b.f_ibb
AND a.f_hbp = b.f_hbp
AND a.f_so = b.f_so
AND a.f_pa = b.f_tbf
ORDER BY a.f_game_date ASC
)
, day_games AS (
SELECT a.game_id, 
a.h_team_id, 
b.v_team_id, 
a.game_date,
a.day_time,
'regular' AS game_type,
b.h_team_bf,
a.h_team_runs,
b.v_team_runs,
CASE WHEN a.h_team_runs > b.v_team_runs THEN a.h_team_id ELSE b.v_team_id END AS winning_team,
CASE WHEN a.h_team_runs > b.v_team_runs THEN a.v_team_id ELSE b.h_team_id END AS losing_team,
SUBSTRING(a.game_date,-4) AS season_id
FROM home_day_team_runs AS a
INNER JOIN away_day_team_runs AS b
ON a.game_id = b.game_id
ORDER BY a.game_date ASC
)
, home_night_team_runs AS (
SELECT 'night' AS day_time,a.f_game_date AS game_date,a.f_team_id AS h_team_id, b.f_team_id AS v_team_id, a.f_r AS h_team_runs, CONCAT(a.f_game_date,a.f_team_id,b.f_team_id,'night',1) AS game_id
FROM fangraphs_lines_games_intake_batting_home_night AS a
INNER JOIN fangraphs_lines_games_intake_pitching_away_night AS b
ON a.f_game_date = b.f_game_date 
AND a.f_r = b.f_r
AND a.f_h = b.f_h 
AND a.f_d = b.f_d
AND a.f_t = b.f_t
AND a.f_hr = b.f_hr
AND a.f_bb = b.f_bb
AND a.f_ibb = b.f_ibb
AND a.f_hbp = b.f_hbp
AND a.f_so = b.f_so
AND a.f_pa = b.f_tbf
ORDER BY a.f_game_date ASC
)
, away_night_team_runs AS (
SELECT 'night' AS day_time, a.f_game_date AS game_date,a.f_team_id AS v_team_id, b.f_team_id AS h_team_id,b.f_tbf AS h_team_bf, a.f_r AS v_team_runs, CONCAT(a.f_game_date,b.f_team_id,a.f_team_id,'night',1) AS game_id
FROM fangraphs_lines_games_intake_batting_away_night AS a
INNER JOIN fangraphs_lines_games_intake_pitching_home_night AS b
ON a.f_game_date = b.f_game_date 
AND a.f_r = b.f_r
AND a.f_h = b.f_h 
AND a.f_d = b.f_d
AND a.f_t = b.f_t
AND a.f_hr = b.f_hr
AND a.f_bb = b.f_bb
AND a.f_ibb = b.f_ibb
AND a.f_hbp = b.f_hbp
AND a.f_so = b.f_so
AND a.f_pa = b.f_tbf
ORDER BY a.f_game_date ASC
)
, night_games AS (
SELECT a.game_id, 
a.h_team_id, 
b.v_team_id, 
a.game_date,
a.day_time,
'regular' AS game_type,
b.h_team_bf,
a.h_team_runs,
b.v_team_runs,
CASE WHEN a.h_team_runs > b.v_team_runs THEN a.h_team_id ELSE b.v_team_id END AS winning_team,
CASE WHEN a.h_team_runs > b.v_team_runs THEN a.v_team_id ELSE b.h_team_id END AS losing_team,
SUBSTRING(a.game_date,-4) AS season_id
FROM home_night_team_runs AS a
INNER JOIN away_night_team_runs AS b
ON a.game_id = b.game_id
ORDER BY a.game_date ASC
)
SELECT *
FROM day_games
UNION 
SELECT *
FROM night_games
